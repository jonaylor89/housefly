<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - TravelSearch</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
  <header class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
      <a href="/" class="text-xl font-bold text-blue-600">TravelSearch</a>
      <nav id="auth-nav" class="flex items-center space-x-4">
        <a href="/" class="text-gray-700 hover:text-blue-600">Home</a>
        <a href="/search" class="text-gray-700 hover:text-blue-600">Search</a>
        <a href="/dashboard" class="text-gray-700 hover:text-blue-600">Dashboard</a>
        <button class="text-gray-700 hover:text-blue-600" onclick="logout()">Logout</button>
      </nav>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-12">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Welcome back!</h1>
    <p class="text-gray-600 mb-8">Manage your saved searches and bookmarks.</p>

    <h2 class="text-2xl font-bold text-gray-900 mb-4">Your Saved Searches</h2>

    <div id="searches-container">
      <p class="text-gray-500" id="no-searches">Loading...</p>
    </div>
  </main>

  <script>
    async function logout() {
      await fetch('/api/auth/logout', { method: 'POST' });
      window.location.href = '/';
    }

    (async () => {
      try {
        const res = await fetch('/api/user/searches');
        if (!res.ok) {
          window.location.href = '/login';
          return;
        }
        const data = await res.json();
        const container = document.getElementById('searches-container');
        const noSearches = document.getElementById('no-searches');

        if (!data.searches || data.searches.length === 0) {
          noSearches.textContent = 'No saved searches yet. Start by searching for a destination!';
          return;
        }

        noSearches.remove();

        data.searches.forEach(search => {
          const div = document.createElement('div');
          div.className = 'border rounded-md p-4 mb-4 bg-white';
          div.innerHTML = `
            <h3 class="text-lg font-semibold text-gray-900 mb-2">${search.destination}</h3>
            <div class="text-sm text-gray-600 mb-2">
              <span>Check-in: ${search.checkIn || 'N/A'}</span> &mdash;
              <span>Check-out: ${search.checkOut || 'N/A'}</span>
            </div>
            <div class="text-sm text-gray-600 mb-2">
              Price range: $${search.minPrice} - $${search.maxPrice}
            </div>
            <div class="flex flex-wrap gap-1">
              ${(search.amenities || []).map(a => `<span class="text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded">${a}</span>`).join('')}
            </div>
            <button class="mt-3 text-sm text-red-600 hover:text-red-800" onclick="deleteSearch('${search.id}', this)">Delete</button>
          `;
          container.appendChild(div);
        });
      } catch (e) {
        console.error(e);
      }
    })();

    async function deleteSearch(id, btn) {
      await fetch('/api/user/searches/' + id, { method: 'DELETE' });
      btn.closest('.border.rounded-md').remove();
      const container = document.getElementById('searches-container');
      if (container.children.length === 0) {
        const p = document.createElement('p');
        p.className = 'text-gray-500';
        p.textContent = 'No saved searches yet. Start by searching for a destination!';
        container.appendChild(p);
      }
    }
  </script>
</body>
</html>
