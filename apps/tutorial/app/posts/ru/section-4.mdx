---
title: 'Продвинутое взаимодействие с веб-сайтами и API'
publishedAt: '2025-04-14'
summary: 'Изучите скрапинг сайтов на основе API, обработку форм и аутентификации, а также взаимодействие с GraphQL-эндпоинтами.'
---

Добро пожаловать в Раздел 4! Мы уже рассмотрели скрапинг статического и отрисованного с помощью JavaScript контента, а также навигацию по многостраничным сайтам. Теперь погрузимся в более сложные сценарии, включающие прямое взаимодействие с API, отправку форм, аутентификацию и специализированные API, такие как GraphQL. Эти техники критически важны для работы с современными веб-приложениями.

### 1. Веб-сайты на основе API (Глава 7)

Многие современные веб-сайты не загружают все данные с исходным HTML. Вместо этого они используют JavaScript для получения данных из API бэкенда (часто с помощью `fetch` или `XMLHttpRequest`) после загрузки страницы. Эффективный скрапинг таких сайтов часто означает обход пользовательского интерфейса и прямое взаимодействие с этими API.

**Ключевые концепции:**

* **Идентификация API-запросов:** Используйте инструменты разработчика вашего браузера (вкладка Network), чтобы обнаружить запросы (обычно XHR/Fetch), возвращающие данные, как правило, в формате JSON.
* **Прямой скрапинг API:** Обнаружив конечную точку API, вы можете часто делать запросы напрямую к ней, используя библиотеки, такие как `axios` или встроенный `fetch` в Node.js. Это обычно быстрее и надежнее, чем автоматизация браузера.
* **Обработка пагинации и параметров:** API часто используют параметры запроса для пагинации (`page`, `limit`), фильтрации или сортировки. Вам потребуется понять и воспроизвести их в вашем скрапинг-скрипте.

**Задача (Глава 7):** Вы будете скрапить сайт электронной коммерции, где списки товаров динамически загружаются из RESTful API. Ваша задача - получить все товары, взаимодействуя с этим API и правильно обрабатывая пагинацию.

*Найдите эталонное решение, демонстрирующее прямой скрапинг API, в каталоге `_solved/chapter7/`.*

### 2. Формы и аутентификация (Глава 8)

Часто ценные данные находятся за экраном входа или требуют отправки сложных форм. Например, платформа бронирования путешествий в Главе 8 требует аутентификации для доступа к основным функциям. Чтобы искать направления (используя автозаполнение), выбирать даты поездки (взаимодействуя с виджетом календаря), применять фильтры и просматривать результаты (включая премиальные объявления, доступные только зарегистрированным пользователям), сначала необходимо автоматизировать процесс входа. Это включает в себя обработку форм, управление сессионными куками (включая потенциальные тайм-ауты, требующие повторной аутентификации, и защиту от CSRF), и, в конечном счете, управление браузером для выполнения действий как реальный пользователь.

**Ключевые концепции:**

* **Автоматизация отправки форм:** Используйте инструменты, такие как Playwright или Puppeteer, для заполнения полей ввода, выбора опций и нажатия кнопок для отправки форм (например, формы входа, поисковые строки, элементы управления фильтрами).
* **Управление аутентификацией:**
  * **На основе куки:** Войдите один раз, и контекст браузера (управляемый Playwright/Puppeteer) часто автоматически обрабатывает сессионные куки для последующих запросов.
  * **На основе токенов (например, JWT):** Войдите, извлеките токен (часто из локального хранилища или ответа API) и включите его в заголовки (например, `Authorization: Bearer <token>`) для последующих API-запросов.
* **Управление сессиями:** Поддерживайте состояние входа на разных страницах или действиях в вашем скрапере.
* **Доступ к защищенному контенту:** После аутентификации вы можете переходить и скрапить страницы или данные, доступные только зарегистрированным пользователям.

**Задача (Глава 8):** Эта глава включает многоэтапный процесс: вход на сайт, переход на страницу поиска, заполнение сложной многокомпонентной формы с фильтрами, извлечение результатов (включая премиум-контент, видимый только после входа), и даже сохранение поиска в пользовательской панели управления.

### 3. Работа с GraphQL API (Глава 9)

GraphQL — это всё более популярная альтернатива REST API. Она позволяет клиентам запрашивать именно те данные, которые им нужны, используя специальный язык запросов.

**Ключевые концепции:**

* **Конечная точка GraphQL:** Обычно существует единственная конечная точка (например, `/graphql` или `/api/graphql`).
* **Язык запросов:** Вам потребуется составлять GraphQL-запросы для указания полей и связей, которые вы хотите получить. Инструменты, такие как Insomnia или Postman, могут помочь исследовать схемы GraphQL.
* **Мутации:** Используются для действий, изменяющих данные (например, для входа или отправки данных), аналогично POST/PUT/DELETE в REST.
* **Аутентификация:** Часто включает отправку заголовка `Authorization`, аналогично REST API, обычно полученного после мутации входа.

**Задача (Глава 9):** Вы будете взаимодействовать с сайтом, основанным на GraphQL API. Задача состоит в том, чтобы пройти аутентификацию через мутацию входа, а затем получить определенные структурированные данные о задачах и профилях пользователей с помощью запросов GraphQL.

Овладение этими продвинутыми техниками значительно расширяет диапазон веб-сайтов и данных, с которыми вы можете эффективно работать. Помните, что всегда нужно выполнять скрапинг ответственно и уважать условия использования веб-сайтов.

Удачного скрапинга!